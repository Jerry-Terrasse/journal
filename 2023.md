## Journal-2023

record my journey in CS, gain from history, sometimes scandal.

### 10.6

#### pip并发下载

`21.3`版本之后支持：

```shell
pip install some-package --use-feature=fast-deps
```

#### .desktop文件设置环境变量

把Exec改成用bash执行

```ini
[Desktop Entry]
Type=Application
Name=MyApp
Icon=myapp-icon
Exec=bash -c 'export MY_ENV_VAR=some_value; /path/to/myapp'
```

### 10.1

#### Tmux翻页

`Ctrl+[`进入翻页模式，上下键&PageUP/PageDown翻页，q键退出翻页模式

#### 统计目录下的文件类型

```shell
find . -type f | sed -n 's/..*\.//p' | sort | uniq -c | sort -nk 1
```

#### 开启热点

[linux-wifi-hotspot](https://wiki.archlinux.org/title/Software_access_point#linux-wifi-hotspot)

```shell
yay -S linux-wifi-hotspot
wihotspot-gui
```

#### Git中文显示

Git会使用八进制编码非ASCII文件名，关闭引用路径功能即可正常显示

```shell
git config --global core.quotepath off
```

### 9.30

### Git误删恢复

执行`git filter-branch --force --index-filter 'git rm --cached --ignore-unmatch *.pdf' --prune-empty --tag-name-filter cat -- --all`清除提交的pdf文件之后不知道为什么，工作树中的pdf文件也都没了

但是git在filter-branch的时候会自动创建备份，可以借此恢复：

```shell
git reset --hard refs/original/refs/heads/master
```

### 9.29

#### Git代理

对于ssh协议的git仓库，http_proxy等环境变量是无效的

[solution](https://gist.github.com/ozbillwang/005bd1dfc597a2f3a00148834ad3e551)

需在ssh配置文件中设置：

```
Host github.com
    Hostname github.com
    ForwardAgent yes
    ProxyCommand nc -X connect -x <proxy_host>:<proxy_port> %h %p
```

### 9.23

#### PyTorch拓展张量维度

```python
# (a, b, ..., c) -> (a, b, ..., x+c+y)
X = torch.nn.functional.pad(X, (x, y), 'constant', 0)
```

#### MatplotLib无法显示

报错：

```
UserWarning: FigureCanvasAgg is non-interactive, and thus cannot be shown
```

解决方案：

```shell
pip install PyQt5
```

#### 提取mp4音频到wav

```shell
ffmpeg -i input.mp4 -vn output.wav
```

### 9.21

#### 用户级systemd自启动

报错：`Unit ***.service is added as a dependency to a non-existent unit multi-user.target.`

原因：`multi-user.target`是系统级target，不能被用户级服务关联

解决方案：使用`default.target`替代

```ini
[Install]
WantedBy=default.target
```

### 9.20

#### Selenium 登录

部分网站能检测出selenium，可以让selenium直接使用已登录的浏览器profile

[solution](https://stackoverflow.com/questions/26642154/specify-a-custom-user-data-directory-in-firefox-using-watir-webdriver-selenium)

```shell
# Create Profile
mkdir profile
firefox --profile ./profile
```

```python
# use profile
opt.profile = './profile'
```

#### VS Code 文件模板

[插件](https://marketplace.visualstudio.com/items?itemName=bam.vscode-file-templates)

#### WPS 粗体异常

[solution](https://forum.manjaro.org/t/wps/144447)

```shell
sudo pacman -U /var/cache/pacman/pkg/freetype2-2.13.0-1-x86_64.pkg.tar.zs
```

### 9.19

#### Proxy Pool

[proxy_pool](https://github.com/jhao104/proxy_pool)

### 9.18

#### Git clone
`fatal: transport 'file' not allowed`

[solution](https://stackoverflow.com/questions/74486167/git-clone-recurse-submodules-throws-error-on-macos-transmission-type-file-n)

```shell
git config --global protocol.file.allow always
```

### 9.16

#### WPS Linux 导出PDF失败

报错`WPS writer encounter an error while trying export to PDF`

[solution](https://bbs.archlinux.org/viewtopic.php?id=285385): `yay -S libtiff5`

#### requests乱码

可能是gzip压缩内容未被requests库解析所致

通过headers设置`'Accept-Encoding': 'utf-8'`即可

#### 编码

常见中文编码：

* Unicode
* UTF-8
* UTF-16
* GB2312
* BIG5
* GBK
* GB18030

自动检测编码：[charset-normalizer](https://pypi.org/project/charset-normalizer/)

### 9.13

### VS Code出错

```
加载 Web 视图时出错: Error: Could not register service workers: InvalidStateError: Failed to register a ServiceWorker: The document is in an invalid state.
```

[Solution](https://github.com/microsoft/vscode/issues/139481)

### 9.12

#### PDF Format

Figure对象也有可能是文本对象的父结点，提取文本时不能忽略

#### Threading

Python中threading共享全局变量，而multiprocessing创建的是进程，拥有独立内存空间

### 9.10

#### Matplotlib

设置横纵坐标等比例

```python
ax.set_aspect('equal', 'box')
```

绘制三维图像

```python
D = -np.array([[float(i) for i in line] for line in data])

x = np.arange(0., 4.001, 0.02)
y = np.arange(0., 5.001, 0.02)
x, y = np.meshgrid(x, y)

fig, ax = plt.subplots(subplot_kw={"projection": "3d"})
ax.plot_surface(x, y, D, cmap=cm.coolwarm)

plt.show()
```

启用网格

```python
ax.grid(True)
ax.set_xticks([N(5/20*i - 2.5) for i in range(20)]) # optional
ax.set_yticks([N(5/20*i - 2.5) for i in range(20)]) # optional
```

绘制矩形

```
field = Rectangle((N(-2), N(-1)), N(4), N(2), fc='b', alpha=0.2)
ax.add_patch(field)
```

### 9.3

[EasyConnect for Manjaro闪退修复](https://www.wannaexpresso.com/2020/06/07/easy-connect-manjaro/)

debtap换源

```shell
sudo sed -i "s|http://ftp.debian.org/debian/dists|https://mirrors.ustc.edu.cn/debian/dists|g" /usr/bin/debtap
sudo sed -i "s|http://archive.ubuntu.com/ubuntu/dists|https://mirrors.ustc.edu.cn/ubuntu/dists|g" /usr/bin/debtap
```

### 9.2

软路由单线多拨实现（待填坑）

### 8.30

#### dd制作镜像

```shell
sudo dd if=/dev/sda of=sdcard-backup.img bs=4M status=progress
sudo dd if=/dev/sdb bs=4M status=progress | gzip > sdcard-backup.img.gz
gunzip -c sdcard-backup.img.gz | sudo dd of=/dev/sdb bs=4M status=progress
```

### 8.29

[adb用法大全](https://mazhuang.org/awesome-adb/)

`itertools.groupby`在使用前需要先sort

### 8.28

[PDF Layout Analysis](https://pdfminersix.readthedocs.io/en/latest/topic/converting_pdf_to_text.html)

#### python拓展名

`.pyc`：编译的字节码

`.pyd`：windows上的dll格式C-extension

`.pyi`：类型提示文件

`.pyx`：cython源文件

### 8.27

#### proxy  setup & IP check

```bash
alias stp="export https_proxy=http://127.0.0.1:7890;export http_proxy=http://127.0.0.1:7890;export all_proxy=socks5://127.0.0.1:7890; curl ipinfo.io; echo;"
alias unsetproxy="unset https_proxy http_proxy all_proxy; curl ipinfo.io; echo;"
```

#### shell控制流

```shell
#!/bin/zsh
while true; do
    echo "forwarding..."
    ssh -NL 3004:localhost:6006 cool9
    echo "try re-authing..."
    sleep 1
    if ./frp_auth/cool9 </dev/null; then
        echo "re-authed successfully"
	sleep 1
    else
	echo "re-authing failed"
	sleep 60
    fi
done
```

if命令的行为是反的，条件返回0则执行then

```shell
#!/bin/zsh
export GIT_WORK_TREE=~/journal
export GIT_DIR=$GIT_WORK_TREE/.git

if git diff --quiet; then
    echo "Already up-to-date"
else
    git add $GIT_WORK_TREE -v
    git commit -m "update (`date`)"
    
    # Request to push
    echo -n "Push? [Y/n]"
    read ans
    case $ans in
      [yY] | "" )
        echo "Push:"
        git push
        ;;
      [nN] )
        echo "Abort."
        ;;

      * )
        echo "Invalid response."
        ;;
    esac
fi
```

#### ssh

端口映射

远程到本机`ssh -L`

本机到远程`ssh -R`

密钥转发

```shell
eval $(ssh-agent -s)
ssh-add /path/to/your/private-key-with-passphrase
ssh -A user@remote-server
```

### START

难绷，去年3月份到现在直接完全忘记写。血亏。一定要坚持下去啊！